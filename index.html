<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- 
    üì± Viewport setup:
    - Allows pinch-zoom on mobile devices
    - Lets users zoom out (see full table)
    - Keeps normal view on tablets & desktops
  -->
  <!-- üì± Fully responsive & zoomable viewport -->
<meta 
  name="viewport" 
  content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=5.0, user-scalable=yes"
/>


  <title>Ben There Bet That!</title>

  <!-- üé® Styles & Fonts -->
  <link rel="stylesheet" href="style.css" />
  <link 
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" 
    rel="stylesheet"
  />

  <!-- ‚úÖ API base configuration (Dev vs Prod) -->
  <script>
    window.API_BASE =
      (location.hostname === "localhost" || location.hostname === "127.0.0.1")
        ? "http://127.0.0.1:5000"
        : "https://bentherebetthat-api.onrender.com";
  </script>
</head>

<body>
  <!-- ===============================
       üîê Authentication Section
  =============================== -->
  <div id="auth-container">
    <div class="auth-card">
      <h1 class="app-title">
        <span class="app-highlight">Ben</span> There <span class="app-highlight">Bet</span> That<span class="app-dot">!</span>
      </h1>
      <p class="app-subtitle">Smart Sports Insights ‚Ä¢ Real-Time Edge</p>

      <!-- Sign In Form -->
      <form id="signin-form" class="auth-form">
        <h2>Sign In</h2>
        <input type="email" id="signin-email" placeholder="Email" required />
        <input type="password" id="signin-password" placeholder="Password" required />
        <button type="submit" id="signin-btn" class="primary-btn">
          Sign In
          <span id="signin-spinner" class="spinner" style="display:none;"></span>
        </button>
      </form>

      <div class="divider">OR</div>

      <!-- Sign Up Form -->
      <form id="signup-form" class="auth-form">
        <h2>Create Account</h2>
        <input type="email" id="signup-email" placeholder="Email" required />
        <input type="password" id="signup-password" placeholder="Password" required />
        <input type="password" id="signup-confirm" placeholder="Confirm Password" required />
        <button type="submit" id="signup-btn" class="secondary-btn">
          Sign Up
          <span id="signup-spinner" class="spinner" style="display:none;"></span>
        </button>
      </form>

      <button id="forgot-btn" class="link-btn">Forgot Password?</button>
      <p id="auth-message"></p>
    </div>
  </div>

  <!-- ===============================
       üèüÔ∏è Main Dashboard
  =============================== -->
  <div id="main-content" style="display:none;">
    <!-- Subscription + Controls Bar -->
    <div class="auth-bar">
      <div>
        <strong id="subscription-status">Subscription: Unknown</strong>
        <div id="access-until" style="display:none;"></div>
      </div>
      <div>
        <button id="cancel-subscription-btn">Cancel Subscription</button>
        <button id="resume-subscription-btn">Resume Subscription</button>
        <button id="subscribeBtn">Subscribe</button>
        <button id="signout-btn" class="secondary-btn button-with-spinner">
          Sign Out
          <div id="logout-spinner" class="spinner-small" style="display:none;"></div>
        </button>
      </div>
    </div>

    <!-- Title -->
    <h1 class="app-title">Ben There <span class="app-highlight">Bet That<span class="app-dot">!</span></span></h1>
    <h2 class="app-subtitle">Smart Sports Insights ‚Ä¢ Real-Time Edge</h2>

    <!-- Sport Buttons -->
    <div class="sport-buttons">
      <button data-sport="americanfootball_nfl">NFL</button>
      <button data-sport="americanfootball_ncaaf">NCAAF</button>
      <button data-sport="basketball_nba">NBA</button>
      <button data-sport="basketball_ncaab">NCAAB</button>
      <button data-sport="baseball_mlb">MLB</button>
      <button data-sport="icehockey_nhl">NHL</button>
    </div>

    <!-- üèüÔ∏è Game Selector -->
    <div id="gameFilterContainer" style="display:none; margin:15px 0;">
      <label for="gameFilter" style="font-weight:600;">Select Games:</label>
      <div style="display:flex; align-items:center; gap:10px; margin-top:6px;">
        <input type="text" id="gameSearch" placeholder="Type to search..." style="flex:1; padding:6px; border-radius:6px; border:1px solid #ccc;" />
        <button id="selectAllGames" class="primary-btn" style="padding:6px 12px;">Select All</button>
        <button id="deselectAllGames" class="secondary-btn" style="padding:6px 12px;">Deselect</button>
      </div>
      <div id="gameButtonContainer" class="game-tiles" style="margin-top:10px;"></div>
    </div>

    <div class="controls date-controls">
  <label for="dateInput" class="date-label">
    <span>üìÖ Select Date</span>
  </label>
  <input type="date" id="dateInput" />
  <button id="loadData" class="primary-btn">Load Data</button>
  <button id="refreshBtn" class="secondary-btn">Refresh Data</button>
  <button id="stopBtn" class="secondary-btn">Stop</button>
</div>


    <!-- üè∑Ô∏è Market Sections -->
    <div id="market-sections">
      <div id="americanfootball_nflMarkets" class="market-buttons" style="display:none;">
        <h3>NFL Markets</h3>
        <div class="market-actions">
          <button id="selectAllNFL" class="select-all-btn">Select All</button>
          <button id="deselectAllNFL" class="deselect-all-btn">Deselect All</button>
        </div>
        <div class="market-list"></div>
      </div>

      <div id="americanfootball_ncaafMarkets" class="market-buttons" style="display:none;">
        <h3>NCAAF Markets</h3>
        <div class="market-actions">
          <button id="selectAllNCAAF" class="select-all-btn">Select All</button>
          <button id="deselectAllNCAAF" class="deselect-all-btn">Deselect All</button>
        </div>
        <div class="market-list"></div>
      </div>

      <div id="basketball_nbaMarkets" class="market-buttons" style="display:none;">
        <h3>NBA Markets</h3>
        <div class="market-actions">
          <button id="selectAllNBA" class="select-all-btn">Select All</button>
          <button id="deselectAllNBA" class="deselect-all-btn">Deselect All</button>
        </div>
        <div class="market-list"></div>
      </div>

      <div id="basketball_ncaabMarkets" class="market-buttons" style="display:none;">
        <h3>NCAAB Markets</h3>
        <div class="market-actions">
          <button id="selectAllNCAAB" class="select-all-btn">Select All</button>
          <button id="deselectAllNCAAB" class="deselect-all-btn">Deselect All</button>
        </div>
        <div class="market-list"></div>
      </div>

      <div id="baseball_mlbMarkets" class="market-buttons" style="display:none;">
        <h3>MLB Markets</h3>
        <div class="market-actions">
          <button id="selectAllMLB" class="select-all-btn">Select All</button>
          <button id="deselectAllMLB" class="deselect-all-btn">Deselect All</button>
        </div>
        <div class="market-list"></div>
      </div>

      <div id="icehockey_nhlMarkets" class="market-buttons" style="display:none;">
        <h3>NHL Markets</h3>
        <div class="market-actions">
          <button id="selectAllHockey" class="select-all-btn">Select All</button>
          <button id="deselectAllHockey" class="deselect-all-btn">Deselect All</button>
        </div>
        <div class="market-list"></div>
      </div>
    </div>

    <!-- üß© Header Actions -->
    <div id="header-container" style="position: sticky; top: 0; z-index: 10; background-color: #fff; padding: 10px;">
      <div class="export-buttons" style="display: flex; justify-content: flex-start; gap: 10px; align-items: center;">
        <button id="exportCsv">Export CSV</button>
        <button id="exportExcel">Export Excel</button>
        <button id="factCheckBtn" class="fact-check-toggle">üß† Fact Check Mode</button>
      </div>

      <div id="bookmaker-filters" class="dropdown-container">
        <label><input type="checkbox" value="Fanduel" checked> Fanduel</label>
        <label><input type="checkbox" value="DraftKings" checked> DraftKings</label>
        <label><input type="checkbox" value="BetMGM" checked> BetMGM</label>
        <label><input type="checkbox" value="Fanatics" checked> Fanatics</label>
      </div>

      <div id="consensus-summary" class="consensus-bar"></div>
    </div>

    <!-- üßæ Results -->
<div id="results"></div>
<div id="loading">Loading data...</div>
<div id="progressText"></div>

<!-- üß† Fact Check Modal -->
<div id="factCheckModal" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Fact Check Details</h2>
    <pre id="factCheckDetails"></pre>
  </div>
</div>

<!-- üîç Floating Zoom Button (Mobile Table Zoom) -->
<button id="zoomToggleBtn" title="Toggle Zoom View">üîç Zoom View</button>

  <!-- ===============================
       üìú Scripts
  =============================== -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
